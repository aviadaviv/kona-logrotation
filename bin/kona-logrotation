#!/usr/bin/env bash

# Set up logging
# LOG_FILE="/var/log/kona-logrotation.log"
# log() {
#     echo "$(date '+%Y-%m-%d %H:%M:%S') - $1" | tee -a "$LOG_FILE"
# }

while true; do
    # Find log files safely using find instead of ls
    log_files=$(find /usr/kona -type f -path "*/current/log/daemon.out" 2>/dev/null)

    if [ -z "$log_files" ]; then
        log "No log files found in /usr/kona/*/current/log/daemon.out"
        sleep 5m
        continue
    fi

    log "Starting log rotation cycle"
    for file in $log_files; do
        if [ -f "$file" ]; then
            log "Processing: $file"
            if ! echo "" > "$file"; then
                log "Error: Failed to clear $file"
            fi
        else
            log "Warning: $file does not exist"
        fi
    done
    log "Completed log rotation cycle"
    sleep 1d
done